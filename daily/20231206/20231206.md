# ğŸ“ 2023ë…„ 12ì›” 6ì¼ ê¸°ë¡
## ìš°ì•„í•˜ê²Œ useEffect ì“°ê¸°

**React18 + StrictMode**ì—ì„œëŠ” ê°œë°œëª¨ë“œì—ì„œ `useEffect`ê°€ ìµœì†Œ ë‘ ë²ˆì´ìƒ ì¼ì–´ë‚  ìˆ˜ ìˆë‹¤.

- ë¦¬ì—‘íŠ¸18ì€ í˜ì´ì§€ ì´ë™ ì´í›„ ë‹¤ì‹œ ëŒì•„ì™”ì„ë•Œ ì•±ì´ ë§ê°€ì§€ëŠ” ë¶€ë¶„ì´ ì—†ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ê°œë°œëª¨ë“œ(`process.env.NODE_ENV === development`)ì—ì„œ í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‘ë²ˆ ë Œë”ë§í•œë‹¤.
- `Strict Mode` ë¥¼ ì—†ì•  ë‘ë²ˆì”© ë Œë”ë§í•˜ëŠ” ê³¼ì •ì´ ì¼ì–´ë‚˜ì§€ ì•Šê²Œ í•  ìˆ˜ ìˆì§€ë§Œ production í™˜ê²½ì—ì„œ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ì˜¤ë¥˜ë¥¼ ë¦¬ì—‘íŠ¸ì—ì„œ ì¡ì•„ì£¼ì§€ ëª»í•˜ë¯€ë¡œ í•­ìƒ Strict Modeì—ì„œ ê°œë°œí•˜ëŠ” ê²ƒì´ ì¢‹ìŒ.

### Effect ê°€ ë‘ ì¼ì–´ë‚˜ë„ ìœ ì €ê°€ ì´ë¥¼ ëŠë¼ì§€ ëª»í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
**í•´ê²°ë°©ë²•**

- í•´ê²°ë°©ë²•ì€ **cleanup** í•¨ìˆ˜ë¥¼ ê¼­ ì‘ì„±í•˜ëŠ” ê²ƒ.
- ê°œë°œëª¨ë“œì—ì„œ `effect -> cleanup -> effect` ì™€ ê°™ì€ ìˆœì„œë¡œ ë¦¬ì—‘íŠ¸ê°€ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ë•Œë¬¸ì— cleanup í•¨ìˆ˜ê°€ í•„ìš”í•œ ë¶€ë¶„ì—ì„œëŠ” ê¼­ ìƒëµí•˜ì§€ ì•Šê³  ì±™ê²¨ì¤˜ì•¼ í•¨.

### props, state ë³€ê²½ì— ë”°ë¼ ë˜ ë‹¤ë¥¸ stateë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•  ë•Œ
- `useEffect` ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ì.ë¶í•„ìš”í•œ ë Œë”ë§ì„ ì•¼ê¸°ì‹œí‚¨ë‹¤.
- ìƒíƒœ ë³€ê²½ì´ ì¼ì–´ë‚˜ë©´ ë¦¬ì—‘íŠ¸ëŠ” ë”ì— ë³€ê²½ëœ stateë¥¼ commití•˜ê³  ê·¸ ì´í›„ì— uië¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.
- ìƒíƒœë³€ê²½ì´ ë‘ë²ˆ ì¼ì–´ë‚˜ë©´ ì´ ê³¼ì •ì´ ë‘ë²ˆ, ìƒíƒœë³€ê²½ì´ ì„¸ë²ˆ ì¼ì–´ë‚˜ë©´ ì„¸ë²ˆ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤.
- uië¥¼ í•œë²ˆ ë³€ê²½í•˜ëŠ”ë° ìƒíƒœ ë³€ê²½ì´ n ë²ˆ ì¼ì–´ë‚œë‹¤ë©´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì´ ìµœëŒ€ n-1ë²ˆ ë°œìƒí•˜ê³  ìˆëŠ” ê²ƒ.

### props, state ë³€ê²½ì— ë”°ë¼ ë°ì´í„°ë¥¼ ì¡°ë¦½í•´ì•¼ í•˜ëŠ” ê²½ìš°

**ì „**
```typescript jsx
function TodoList({ todos, filter }) {
  const [newTodo, setNewTodo] = useState('');

  // ğŸ”´ Avoid: redundant state and unnecessary Effect
  const [visibleTodos, setVisibleTodos] = useState([]);
  useEffect(() => {
    setVisibleTodos(getFilteredTodos(todos, filter));
  }, [todos, filter]);

  // ...
}
```

**í›„**
```typescript jsx
function TodoList({ todos, filter }) {
  const [newTodo, setNewTodo] = useState('');
  // âœ… This is fine if getFilteredTodos() is not slow.
  const visibleTodos = getFilteredTodos(todos, filter);
  // ...
}
```
ui ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ setVisibleTodosë¥¼ í˜¸ì¶œí•´ì£¼ì§€ ì•Šì•„ë„ ê´œì°®ë‹¤.


### props ë³€ê²½ì— ë”°ë¼ ìƒíƒœê°€ ë¦¬ì…‹ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°
```typescript jsx
export default function ProfilePage({ userId }) {
  const [comment, setComment] = useState('');

  // ğŸ”´ Avoid: Resetting state on prop change in an Effect
  useEffect(() => {
    setComment('');
  }, [userId]);
  // ...
}
```
userId ë³€ê²½ -> ë¦¬ë Œë”ë§ -> comment ë³€ê²½ -> ë¦¬ë Œë”ë§.

```typescript jsx
export default function ProfilePage({ userId }) {
  return (
    <Profile
      userId={userId} 
      key={userId}
    />
  );
}

function Profile({ userId }) {
  // âœ… This and any other state below will reset on key change automatically
  const [comment, setComment] = useState('');
  // ...
}
```
- `Profile` ì»´í¬ë„ŒíŠ¸ëŠ” userIdê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ key ê°’ì´ ë³€ê²½ë˜ê¸° ë•Œë¬¸ì— comment ìƒíƒœë¥¼ ë”°ë¡œ ë¦¬ì…‹í•´ì¤„ í•„ìš”ê°€ ì—†ë‹¤.

### props ë³€ê²½ì— ë”°ë¼ íŠ¹ì • ìƒíƒœë§Œ ì—…ë°ì´íŠ¸ í•´ì•¼ í•˜ëŠ” ê²½ìš°
```typescript jsx
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // ğŸ”´ Avoid: Adjusting state on prop change in an Effect
  useEffect(() => {
    setSelection(null);
  }, [items]);
  // ...
}
```
itemsê°€ ë³€ê²½ë˜ë©´ -> ë¦¬ë Œë”ë§ -> selection ë³€ê²½ -> ë¦¬ë Œë”ë§

```typescript jsx
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // Better: Adjust the state while rendering
  const [prevItems, setPrevItems] = useState(items);
  if (items !== prevItems) {
    setPrevItems(items);
    setSelection(null);
  }
  // ...
}
```
### useEffect vs eventHandler - UI rendering
- useEffect, event handler ë‘˜ ì¤‘ ì–´ë””ì— ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ë‹¤ë©´, ì½”ë“œê°€ ì–¸ì œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ”ì§€ ìƒê°í•´ë³´ì.
- use effectëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë˜ëŠ” ì‹œì ì— ìœ ì €ì—ê²Œ í‘œí˜„ë˜ì–´ì•¼ í•  ë¡œì§ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©.




**[ì¶œì²˜]**
> https://velog.io/@jay/you-might-need-useEffect-diet
